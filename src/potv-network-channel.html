<!--
 Polymer Custom Element representing network channel (incoming/outgoing packages) in Puppet Operational Transformation communication Visualization
 -->
<!-- Import Polymer -->
<link rel="import" href="../../polymer/polymer.html">

<!-- Define your custom element -->
<polymer-element name="potv-network-channel" attributes="direction">
<template>
    <style>
     :host{
        display: flex;
        justify-content: center;
        flex-direction: column;
        width: 50px;
        height: 100%;
     }
     #network-channel{
        flex:1;
        display: flex;
        position: relative;
        height: 100%;
        width: 100%;
        overflow: hidden;
     }
     #wireTube{
        width:100%;
        height:100%;
        position:absolute;
     }
     #wire{
        border-left: 3px dashed #daedef;
        width: 1px; 
        height:100%; 
        margin: 0 auto;
     }
     #packets{
        flex: 1;
        display: flex;
        justify-content: center;
        flex-direction: column-reverse;
        width: calc( 100% - 24px );
        min-height:100%; 
        margin: 2% 12px;
     }

     .up>#packets{
        flex-direction: column
     }
     a {
        position: absolute;
        left: 0;
        text-decoration: none;
        font-size: 24px;
        font-weight: bold;
        color: #1e488d;

        top: auto;
        bottom: 14px;
     }
     a[disabled] {
        color: #cadce4;
        cursor: default;
     }
     .up>a{
        top: 10px;
        bottom: auto;
     }
     ::content>*{
        top:0;
        align-self: center;
        /*transition: all {{transitionTime}}s ease-in-out;
        -moz-transition: all {{transitionTime}}s ease-in-out;
        -webkit-transition: all {{transitionTime}}s ease-in-out;*/
        transition: all 0.5s ease-in-out;
        -moz-transition: all 0.5s ease-in-out;
        -webkit-transition: all 0.5s ease-in-out;
        position: relative;
     }
    </style>
    <div id="network-channel" class="{{direction}}">
        <div id="wireTube">
            <div id="wire">
            </div>
        </div>
        <div id="packets">
            <!-- <span class="operation" title="Operation"></span> -->
            <content></content>
        </div>
        <a href="" disabled?="{{disabled}}" on-click="{{transfer}}" class="{{direction}}">{{direction == 'up'?  '&uarr;' : '&darr;' }}</a>
    </div>
</template>

    <script>
        Polymer('potv-network-channel', {
            /** {Number} transition time in seconds */
            transitionTime: 0.5,
            disabled: true,
            transfer: function( index ){
                index = index || 0;
                if( index && index.preventDefault){ // index is event
                    index.preventDefault();
                    index = 0;
                }
                var operation;
                operation = this.children[index];
                if(!operation){ 
                    return false;
                }
                if(this.direction == "up"){
                    operation.style.top = operation.style.top || 0 + "px";
                    // operation.style.position = "relative";
                    operation.style.top = (-operation.offsetTop -operation.offsetHeight) + "px";

                } else {
                    operation.style.top = operation.style.top || 0 + "px";
                    // operation.style.position = "relative";
                    operation.style.top = (this.offsetHeight - operation.offsetTop) + "px";
                }

                var channel = this;
                setTimeout(function(){//remove after transition is done
                    channel.removeChild(operation);
                    // channel.disabled = channel.children.length == 0;
                    channel.dispatchEvent( new CustomEvent("transfered", {detail:{"package": operation}}) );
                }, this.transitionTime * 1000);
                return operation;
            },
            // Fires when the elementâ€™s initial set of children and siblings are guaranteed to exist
            domReady: function() {
                this.disabled = this.children.length == 0;
                var channel = this;
                var observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        channel.disabled = channel.children.length == 0;
                    });
                });
                observer.observe(this, { childList: true });
            }
        });
    </script>

</polymer-element>